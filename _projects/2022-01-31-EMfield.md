---
title: "Particles in Electromagnetic Fields"
categories:
  - project
tags:
  - Physics Simulation
cover-img: ../emfield/field.png
toc: true
toc_sticky: true
author_profile: true
classes: false

---
# Introduction
In many fields of physics, it is important to study the dynamics of single particles, but there are few cases in which an analytical solution is possible. \\
For example, if I consider a charged particle in motion interacting with the electromagnetic field, the equation that describes its dynamics is the following:

\begin{equation} \label{eq:1}
\frac{d\mathbf{v}}{dt}=\frac{q}{m}(\mathbf{E}+\mathbf{v}\times\mathbf{B}) 
\end{equation}
The analytical solution is possible in a few cases, in particular with simple $ \mathbf{E} $ and $ \mathbf{B} $ configurations. It is therefore essential to resort to numerical methods, in particular in this case numerically integrate the equation of motion.\\
The first step towards the numerical solution is the rewriting of from SI units in a dimensionless form, to avoid any numerical cancellations due to the different scales of the quantities present.


<!--$$\mathbf{\mathbf{\tilde{v}}}=\frac{\mathbf{v}}{v_0} \;\;\;\;\tilde{t}=\frac{t}{t_0} \;\; \; \tilde{\mathbf{E}}=\frac{\mathbf{E}}{E_0}  \; \;\;\tilde{\mathbf{B}}=\frac{\mathbf{B}}{B_0}$$ \\
dove $v_0,\;t_0,\; E_0,\; B_0$ they are constants with the same dimensions as the initial variable to obtain pure dimensionless numbers.
Can I rewrite $ \mathbf{v}, \; t, \; \mathbf{E}, \; \mathbf{B} $ as

$$ \mathbf{v}=\tilde{\mathbf{v}}\;v_0 \; \; \; t=\tilde{t}\;t_0 \;\; \; \mathbf{E}=\tilde{\mathbf{E}}\;E_0 \;\; \;\mathbf{B}=\tilde{\mathbf{B}}\;B_0 $$-->



<!--Sostituisco nell'equazione \eqref{eq:1}:

$$\frac{v_0d\mathbf{\tilde{v}}}{t_0d\tilde{t}}=\frac{q}{m}(\mathbf{\tilde{E}}E_0+\mathbf{\mathbf{\tilde{v}}}v_0\times\mathbf{\tilde{B}}B_0) \quad  \quad \frac{d\mathbf{\tilde{v}}}{d\tilde{t}} =\frac{qt_0}{mv_0}(\mathbf{\tilde{E}}E_0+\mathbf{\tilde{v}}v_0\times\mathbf{\tilde{B}}B_0)$$

$$\frac{d\mathbf{\tilde{v}}}{d\tilde{t}}=\frac{qt_0 E_0}{mv_0}\mathbf{E}+\frac{qt_0}{mv_0}v_0 B_0  v \times \mathbf{B} $$


$$\frac{qt_0 E_0}{mv_0}=1 \;\;\;\;\; t_0=\frac{mv_0}{q E_0}$$
sostituisco $t_0$ nel coefficiente davanti a $\mathbf{v} \times \mathbf{B}:$
$$\frac{qB_0}{m } \frac{m v_0}{q E_0}=\frac{B_0}{E_0}{v_0}=1 \;\;\;\;\; E_0=B_0v_0$$
In questo modo ottengo la forma adimensionale dell'equazione di Lorentz (omettendo le tilde):
$$\frac{d\mathbf{v}}{dt}=\mathbf{E}+\mathbf{v} \times \mathbf{B} $$
Non sembra molto diversa rispetto alla prima versione ma ora le grandezze sono adimensionali. \\-->



Con questa procedura di adimensionalizzazione definisco delle scale rispetto a cui tratto il problema per via numerica.
$$t_0 = \frac{m  v_0} {q  E_0}\; [s] \qquad v_0 = \frac{E_0}{B_0} \; \left[\frac{m}{s}\right] \qquad l_0 = v_0\;t_0 \; [m]$$



# Choice of the numerical integrator
As regards the choice of the integration method of the differential equation, I compared three different integrators:  Runge-Kutta 2nd order, Runge-Kutta 4th order and as the system is Hamiltonian a symplectic integrator that preserves the total system energy. \\
The symplectic integrators  Position-Verlet and  Velocity-Verlet often used to integrate the equations of motion are not suitable as one of the hypotheses of these methods is that the force is independent of the velocity. \\
I therefore used the  Boris Pusher} a symplectic integrator suitable for integrating the equation of motion of a particle subject to the Lorentz force. \\
To demonstrate the advantages of the Boris integrator I will analyze a simple case that is the motion of a charged particle immersed in a constant magnetic field.

# One particle and magnetic field B
Considero due casi uno in cui la velocitá della particella é parallela a B e in cui la velocitá é perpendicolare a B.


## Parallel Velocity

$$\mathbf{v}_0=(0,0,v_z) \qquad v_z=1$$

$$\mathbf{B}=(0,0,B_z) \qquad B_z=1$$

Otteniamo una dinamica di questo tipo:

$$
\begin{cases} 
\frac{dv_x}{dt}= 0 \\
\frac{dv_y}{dt}= 0   \\
\frac{dv_z}{dt}= 0 
\end{cases}
$$

per cui la $\mathbf{v}$ sará costante, uguale a $v_0$ iniziale per cui la particella si muoverá di moto uniforme in direzione $z$.

## Normal Velocity
$$\mathbf{v}_0=(v_x,0,0) \qquad v_x=1 $$
$$\mathbf{B}=(0,0,B_z) \qquad B_z=1$$
$$
\begin{cases} 
\frac{dv_x}{dt}= 0  \\
\frac{dv_y}{dt}= - Bv_x\\
\frac{dv_z}{dt}=0 
\end{cases}
$$
Eguaglio la forza di Lorentz con la forza centripeta:

$$ F_L=F_c \quad vB=\frac{v^2}{R} \quad B=\frac{v}{R} \quad R=\frac{v}{B}=1 $$

Calcolo ora il periodo di rotazione sostituendo R:
$$T=\frac{2\pi}{\omega}=\frac{2\pi R}{v} \qquad T=\frac{2\pi}{v}\frac{v}{B} = \frac{2\pi}{B} = 2\pi$$
I risultati numerici coincidono con i risultati analitici attesi se si riportano le unitá di misura correttamente. \\
Scegliendo come valori arbitrari $E = 0.01 \; \frac{V}{m}$ e $B = 10^{-8} \; T $ e considerando come particella un elettrone quindi  $q = 1.6 \times 10^{-19} \;C $ e $m = 9 \times 10^{-31} \; kg$ otteniamo le scale rispetto alle quali abbiamo adimensionalizzato il problema:
 $$t_0 = \frac{m  v_0} {q  E_0} =  5.625 \times 10^{-4} \; s  \qquad l_0 = \frac{E_0t_0}{B_0} = 562.5 \; m  \qquad v_0 = \frac{l_0}{t_0} = 10^6 \; \frac{m}{s}$$
Per esempio volessimo convertire da grandezza adimensionale a unitá SI:
- il raggio dell'orbita circolare: $R = 1 \times l_0 = 562.5 \; m $
-  il periodo dell'orbita circolare: $T = 2\pi \times t_0 = 3.53 \; s $
- l'energia cinetica dell'elettrone: $ E = \frac{1}{2}m \times v_0^2 = 4.5 \times 10^{-19} \;J$


<figure class="half">
  <a href="../emfield/3dposizione.png">
  <img src="../emfield/3dposizione.png"></a>

  <a href="../emfield/tempovelocitá.png">
  <img src="../emfield/tempovelocitá.png"></a>
  
  <figcaption> Velocitá perpendicolare a $\mathbf{B}$ </figcaption>
</figure>


## Comparison betweeen Rk2, Rk4 and Boris Pusher

<figure class="half">
  <a href="../emfield/confronto_traiettorie.png">
  <img src="../emfield/confronto_traiettorie.png"></a>

  <a href="../emfield/erroreE.png">
  <img src="../emfield/erroreE.png"></a>
  
  <figcaption> Confronto tra RK2, RK4 e Boris Pusher con un timestep dt = 0.25 e 1000 step </figcaption>
</figure>


I evaluate the different behavior of the three integrators considering how the energy of the particle varies during integration.
In fact, the considered physical system conserves the initial energy so I expect that the numerical simulation will also preserve it. \\
$$ \Delta E = \frac{| E-E_0 |}{E_0} = \frac{| \mathbf{v} ^ 2 - \mathbf{v} _0 ^ 2 |}{\mathbf{v} _0 ^ 2 } $$
I evaluate the relative error on the energy considering only the kinetic energy of the particle as the magnetic field B does not provide energy as it is always perpendicular to the direction of displacement, therefore it affects only the direction of the velocity and not the modulus.
The error for Rk2 and Rk4 reaches relevant values ​​and would continue to grow, while Boris' algorithm maintains a constant negligible error between a $ 10 ^{- 16} $ and $ 10 ^{- 14} $. We verify that the use of a symplectic supplement allows the conservation of the initial energy.
In the following simulations the Boris integrator will be implemented.

# ExB Drift
Ora consideriamo il moto di una particella in moto in presenza anche di un campo elettrico E oltre al campo magnetico B.
$$\mathbf{B}=(0,0,B_z) \qquad B_z=1   $$
$$\mathbf{E}=(0,E_y,0) \qquad E_y=0.5 $$
$$
\begin{cases} 
\frac{dv_x}{dt}=v_y B_z \\
\frac{dv_y}{dt}=E_y  \\
\frac{dv_z}{dt}=0 
\end{cases}
$$

<figure class="half">
  <a href="../emfield/3dposizionedrift.png">
  <img src="../emfield/3dposizionedrift.png"></a>

  <a href="../emfield/vdrift.png">
  <img src="../emfield/vdrift.png"></a>
  
  <figcaption> Plots about ExB Drift </figcaption>
</figure>


The trajectory of the particle follows a cycloid along the x direction. The motion is unexpected having an electric field acting in the $ y $ direction which constantly accelerates the particle along this direction. \\\
In reality, when the speed of the particle increases, the force resulting from the interaction with $ \mathbf{B} $ also increases, always normal with respect to the trajectory.
In fact, the charge stopped at the origin undergoes an acceleration along y due to $ \mathbf{E} $. As soon as the charge begins to move the magnetic force acts in the direction normal to the trajectory. This until the end of the period where the resulting force is zero, so the charge stops and the motion is repeated periodically.

# 10k Particles
I place $ N = 10 ^ 4 $ particles in a square $ L \times L $ with uniformly distributed position and velocity. In particular, the velocity of each will be $ | v | = 0.1 $ and a random direction obtained with a random angle between $ 0 $ and $ 2 \pi $. \\
The particles are immersed in an electric and magnetic field:
$$\vec{E}=\left(0,0,\frac{1}{2} \right)$$
$$\vec{B}=\left(\frac{y}{L},\frac{x}{L},0\right) $$ 
Scrivo le equazioni del moto:


$$
\begin{cases} 
\frac{dv_x}{dt}= 0 \\
\frac{dv_y}{dt}= 0 \\
\frac{dv_z}{dt}= \frac{1}{2} + \frac{x}{L}v_x - \frac{y}{L}v_y 
\end{cases}
$$

The particles perform a peculiar motion, in fact the particles located in the central area of ​​the square are accelerated more towards $ z $ giving effect to a sort of jet of particles. While at the base of the cone concentric oscillations can be observed.


<figure class="third">
  <a href="../emfield/distrib_70.png">
  <img src="../emfield/distrib_70.png"></a>

  <a href="../emfield/distrib_120.png">
  <img src="../emfield/distrib_120.png"></a>
  
  <a href="../emfield/distrib_160.png">
  <img src="../emfield/distrib_160.png"></a>

  <figcaption> Particles positions in three different epochs</figcaption>
</figure>


# Conclusions

We have considered three different examples of particles in electric and magnetic fields, in particular for the last case the numerical simulation has allowed us to understand the non-trivial dynamics of the system.